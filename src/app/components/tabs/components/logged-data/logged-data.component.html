<app-notification></app-notification>
<app-progress-bar></app-progress-bar>
<div class="container-fluid mt-5" *ngIf="mode !== null">
  <!-- table date picker row -->
  <form
    action=""
    method="GET"
    enctype="multipart/form-data"
    (ngSubmit)="search()"
    class="profile-form"
    autocomplete="off"
    #userForm="ngForm"
  >
    <div class="row my-1">
      <div class="col-xl-12">
        <h2 class="text-center my-2">User Login Records</h2>
        <h6 class="my-2 text-style">
          Search by dates | total records: {{ userLoggedTimes }}
        </h6>
      </div>
    </div>
    <div class="row" *ngIf="loggedUser && user !== null">
      <!-- date pickers -->
      <div class="col-xl-9 col-lg-9 col-md-8 col-12">
        <div class="row">
          <div
            class="col-sm-6 col-12 my-2 d-flex justify-content-center align-items-center"
          >
            <mat-form-field appearance="fill" class="form-field w-100">
              <mat-label [ngClass]="isTableEmpty ? 'text-danger' : ''">{{
                isTableEmpty ? "Click the reset" : "Select the start date"
              }}</mat-label>
              <input
                matInput
                [matDatepicker]="pickerStart"
                placeholder="Date Start"
                [(ngModel)]="startDate"
                name="startDate"
                [ngClass]="isTableEmpty ? 'text-danger' : ''"
                placeholder="DD/MM/YYYY"
              />
              <mat-datepicker-toggle
                matIconSuffix
                [for]="pickerStart"
              ></mat-datepicker-toggle>
              <mat-datepicker #pickerStart [touchUi]="true"></mat-datepicker>
            </mat-form-field>
          </div>
          <div
            class="col-sm-6 col-12 my-2 d-flex justify-content-center align-items-center"
          >
            <mat-form-field appearance="fill" class="form-field w-100">
              <mat-label [ngClass]="isTableEmpty ? 'text-danger' : ''">{{
                isTableEmpty ? "Click the reset" : "Select the end date"
              }}</mat-label>
              <input
                matInput
                [matDatepicker]="pickerEnd"
                placeholder="Date End"
                [(ngModel)]="endDate"
                [ngClass]="isTableEmpty ? 'text-danger' : ''"
                name="endDate"
                placeholder="DD/MM/YYYY"
              />
              <mat-datepicker-toggle
                matIconSuffix
                [for]="pickerEnd"
              ></mat-datepicker-toggle>
              <mat-datepicker #pickerEnd [touchUi]="true"></mat-datepicker>
            </mat-form-field>
          </div>
        </div>
      </div>
      <!-- date pickers end -->
      <!-- btns -->
      <div
        class="col-xl-3 col-lg-3 col-md-4 col-sm-12 col-12 d-flex justify-content-center align-items-center"
      >
        <div class="row">
          <div class="col-4 d-flex justify-content-end align-items-center">
            <button
              type="submit"
              class="btn-custom date-picker-btn"
              matTooltip="Search"
              matTooltipPosition="above"
              matTooltipPositionAtOrigin="left"
              [disabled]="isTableEmpty"
            >
              <mat-icon
                aria-hidden="false"
                aria-label="Example home icon"
                svgIcon="search"
                class="search"
              ></mat-icon>
            </button>
          </div>
          <div class="col-4 d-flex justify-content-center align-items-center">
            <button
              type="button"
              class="btn-warning date-picker-btn"
              (click)="reset()"
              matTooltip="Reset"
              matTooltipPosition="above"
              matTooltipPositionAtOrigin="left"
            >
              <mat-icon
                aria-hidden="false"
                aria-label="Example home icon"
                svgIcon="reset"
              ></mat-icon>
            </button>
          </div>
          <div class="col-4 d-flex justify-content-start align-items-center">
            <button
              type="button"
              class="btn-view date-picker-btn"
              (click)="exportToExcel()"
              matTooltip="Download to excel"
              matTooltipPosition="above"
              matTooltipPositionAtOrigin="left"
            >
              <mat-icon
                aria-hidden="false"
                aria-label="Example home icon"
                class="excel"
                svgIcon="fileExcel"
              ></mat-icon>
            </button>
          </div>
        </div>
      </div>
      <!-- btns end -->
    </div>
  </form>

  <!-- table loader row -->
  <div class="row mt-3" *ngIf="userLoggedData && user !== null && isLoading">
    <div class="col-xl-6">
      <h5 class="mb-3 text-uppercase text-center">User Login Comparison</h5>
      <app-skeleton-loader
        [Mode]="mode"
        [width]="'100%'"
        [height]="'21rem'"
        [borderRadius]="'3rem'"
      ></app-skeleton-loader>
    </div>
    <div class="col-xl-6">
      <!-- loader -->
      <div class="table-responsive">
        <table class="w-100">
          <thead>
            <tr class="border-bottom-custom mt-3">
              <th scope="col" class="w-50 text-default">IP Address</th>
              <th scope="col" class="w-50 text-default">Date</th>
            </tr>
          </thead>
          <tbody>
            <tr
              *ngFor="let i of [].constructor(10); let idx = index"
              class="border-bottom-custom mt-3"
            >
              <td class="p-1">
                <app-skeleton-loader
                  [Mode]="mode"
                  [width]="'15rem'"
                  [height]="'1.5rem'"
                  [borderRadius]="'0.159rem'"
                ></app-skeleton-loader>
              </td>
              <td>
                <app-skeleton-loader
                  [Mode]="mode"
                  [width]="'15rem'"
                  [height]="'1.5rem'"
                  [borderRadius]="'0.159rem'"
                ></app-skeleton-loader>
              </td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>
  </div>

  <!-- table data row -->
  <div
    class="row"
    *ngIf="userLoggedData && user !== null && !isTableEmpty && !isLoading"
  >
    <div class="col-xl-6 d-flex justify-content-center align-items-center">
      <div class="chart-wrapper w-100" *ngIf="tablePieChart !== null">
        <h5 class="mb-3 text-uppercase text-center">User Login Comparison</h5>
        <google-chart
          class="google-chart d-flex mx-auto"
          [title]="tablePieChart.title"
          [type]="tablePieChart.type"
          [data]="tablePieChart.data"
          [options]="tablePieChart.options || {}"
          [width]="
            tablePieChart.width !== undefined ? +tablePieChart.width : undefined
          "
          [height]="
            tablePieChart.height !== undefined
              ? +tablePieChart.height
              : undefined
          "
        ></google-chart>
      </div>
    </div>
    <div class="col-xl-6">
      <!-- data -->
      <div class="table-responsive">
        <table
          mat-table
          [dataSource]="dataSource"
          class="mat-elevation-z8"
          matSort
          (matSortChange)="sortData($event)"
        >
          <ng-container matColumnDef="IP Address">
            <th
              mat-header-cell
              *matHeaderCellDef
              mat-sort-header="ip_address"
              scope="col"
              class="w-50 text-default text-center"
            >
              IP Address
            </th>
            <td mat-cell *matCellDef="let element" class="text-default">
              {{ element.ip }}
            </td>
          </ng-container>

          <ng-container matColumnDef="Date">
            <th
              mat-header-cell
              *matHeaderCellDef
              mat-sort-header="date"
              scope="col"
              class="w-50 text-default text-center"
            >
              Date
            </th>
            <td mat-cell *matCellDef="let element" class="text-default">
              {{ element.date | date : "'MMMM d, y HH:mm:ss" }}
            </td>
          </ng-container>

          <tr
            mat-header-row
            *matHeaderRowDef="displayedColumns"
            scope="row"
            class="text-default border-bottom-custom"
          ></tr>
          <tr
            mat-row
            *matRowDef="let row; columns: displayedColumns"
            scope="row"
            class="text-default border-bottom-custom"
          ></tr>
        </table>
      </div>
    </div>
  </div>

  <!-- pagination row -->
  <div
    class="row"
    *ngIf="
      userLoggedData && user !== null && !isTableEmpty && !isPaginationOpen
    "
  >
    <div class="col-xl-12">
      <!-- pagination -->
      <div class="row mt-4">
        <div class="col-xl-12">
          <ul class="pagination justify-content-center d-flex">
            <li class="d-flex justify-content-center align-items-center">
              <button
                type="button"
                class="page-item-btn btn-custom w-100 h-75 fw-bold"
                (click)="goThreePagesBack()"
              >
                <i class="fa fa-angle-double-left"></i>
              </button>
            </li>
            <li
              class="d-flex justify-content-center align-items-center"
              *ngFor="
                let i of [].constructor(getActualEnd() - getActualStart() + 1);
                let idx = index
              "
            >
              <button
                type="button"
                class="page-item-btn btn-custom w-100 h-75 fw-bold"
                [ngClass]="
                  getCurrentPage() === getActualStart() + idx
                    ? 'active'
                    : 'inactive'
                "
                (click)="goToThePage(getActualStart() + idx)"
              >
                {{ getActualStart() + idx }}
              </button>
            </li>
            <li class="d-flex justify-content-center align-items-center">
              <button
                type="button"
                class="page-item-btn btn-custom w-100 h-75 fw-bold"
                (click)="goThreePagesForward()"
              >
                <i class="fa fa-angle-double-right"></i>
              </button>
            </li>
          </ul>
        </div>
      </div>
    </div>
  </div>

  <div class="row mt-5" *ngIf="!isTableEmpty">
    <!-- User login campaire to the others according to the table -->

    <!-- User login campaire to the others at all time -->
  </div>

  <!-- No table data -->
  <div
    *ngIf="isTableEmpty"
    class="row mt-5 d-flex justify-content-center align-item-center"
  >
    <div class="col-xl-8 d-flex justify-content-center align-item-center">
      <div class="">
        <h5 class="text-center text-uppercase" *ngIf="startDate && endDate">
          Logged Data Not Found between
          {{ startDate | date : "MMMM d, y" }} -
          {{ endDate | date : "MMMM d, y" }}
        </h5>
        <h5 class="text-center text-uppercase" *ngIf="!startDate && !endDate">
          Logged Data Not Found
        </h5>
        <div class="image-container">
          <img
            src="/Images/System-images/noActivities.jpg"
            alt="no activities image"
          />
        </div>
      </div>
    </div>
  </div>
</div>
