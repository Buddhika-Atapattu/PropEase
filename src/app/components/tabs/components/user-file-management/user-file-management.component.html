<app-notification></app-notification>
<app-progress-bar></app-progress-bar>
<div class="container-fluid mt-5" *ngIf="mode !== null">
  <!-- table date picker row -->
  <form
    action=""
    method="GET"
    enctype="multipart/form-data"
    (ngSubmit)="search()"
    class="profile-form"
    autocomplete="off"
    #userForm="ngForm"
  >
    <div class="row my-1">
      <div class="col-xl-12">
        <h2 class="text-center my-2">User File Records</h2>
        <h6 class="my-2 text-style">
          Search by dates | total records: {{ totalRecords }}
        </h6>
      </div>
    </div>
    <div class="row" *ngIf="loggedUser && user !== null">
      <!-- date pickers -->
      <div class="col-xl-9 col-lg-9 col-md-8 col-12">
        <div class="row">
          <div
            class="col-sm-6 col-12 my-2 d-flex justify-content-center align-items-center"
          >
            <mat-form-field appearance="fill" class="form-field w-100">
              <mat-label [ngClass]="isTableEmpty ? 'text-danger' : ''">{{
                isTableEmpty ? "Click the reset" : "Select the start date"
              }}</mat-label>
              <input
                matInput
                [matDatepicker]="pickerStart"
                placeholder="Date Start"
                [(ngModel)]="startDate"
                name="startDate"
                [ngClass]="isTableEmpty ? 'text-danger' : ''"
                placeholder="DD/MM/YYYY"
              />
              <mat-datepicker-toggle
                matIconSuffix
                [for]="pickerStart"
              ></mat-datepicker-toggle>
              <mat-datepicker #pickerStart [touchUi]="true"></mat-datepicker>
            </mat-form-field>
          </div>
          <div
            class="col-sm-6 col-12 my-2 d-flex justify-content-center align-items-center"
          >
            <mat-form-field appearance="fill" class="form-field w-100">
              <mat-label [ngClass]="isTableEmpty ? 'text-danger' : ''">{{
                isTableEmpty ? "Click the reset" : "Select the end date"
              }}</mat-label>
              <input
                matInput
                [matDatepicker]="pickerEnd"
                placeholder="Date End"
                [(ngModel)]="endDate"
                [ngClass]="isTableEmpty ? 'text-danger' : ''"
                name="endDate"
                placeholder="DD/MM/YYYY"
              />
              <mat-datepicker-toggle
                matIconSuffix
                [for]="pickerEnd"
              ></mat-datepicker-toggle>
              <mat-datepicker #pickerEnd [touchUi]="true"></mat-datepicker>
            </mat-form-field>
          </div>
        </div>
      </div>
      <!-- date pickers end -->
      <!-- btns -->
      <div
        class="col-xl-3 col-lg-3 col-md-4 col-sm-12 col-12 d-flex justify-content-center align-items-center"
      >
        <div class="row">
          <div class="col-4 d-flex justify-content-end align-items-center">
            <button
              type="submit"
              class="btn-custom date-picker-btn"
              matTooltip="Search"
              matTooltipPosition="above"
              [disabled]="isTableEmpty"
            >
              <mat-icon
                aria-hidden="false"
                aria-label="Example home icon"
                svgIcon="search"
                class="search"
              ></mat-icon>
            </button>
          </div>
          <div class="col-4 d-flex justify-content-center align-items-center">
            <button
              type="button"
              class="btn-edit date-picker-btn"
              (click)="reset()"
              matTooltip="Reset"
              matTooltipPosition="above"
            >
              <mat-icon
                aria-hidden="false"
                aria-label="Example home icon"
                svgIcon="reset"
              ></mat-icon>
            </button>
          </div>
          <div class="col-4 d-flex justify-content-start align-items-center">
            <button
              type="button"
              class="btn-view date-picker-btn"
              (click)="exportToExcel()"
              matTooltip="Download to excel"
              matTooltipPosition="above"
            >
              <mat-icon
                aria-hidden="false"
                aria-label="Example home icon"
                class="excel"
                svgIcon="fileExcel"
              ></mat-icon>
            </button>
          </div>
        </div>
      </div>
      <!-- btns end -->
    </div>
  </form>

  <!-- table data row -->
  <div class="row" *ngIf="loggedUser && user !== null && !isTableEmpty">
    <div class="col-xl-12">
      <!-- data -->
      <div class="table-responsive">
        <table
          mat-table
          [dataSource]="dataSource"
          class="mat-elevation-z8"
          class="w-100"
          matSort
          (matSortChange)="sortData($event)"
        >
          <ng-container
            *ngFor="let col of displayedColumns"
            [matColumnDef]="col"
          >
            <th
              mat-header-cell
              *matHeaderCellDef
              mat-sort-header="{{ col }}"
              class="w-50 text-default text-center"
            >
              <div *ngIf="isLoading">
                <app-skeleton-loader
                  [Mode]="mode"
                  [width]="'5rem'"
                  [height]="'1.5rem'"
                  [borderRadius]="'0.159rem'"
                ></app-skeleton-loader>
              </div>
              <div *ngIf="!isLoading">
                {{ col }}
              </div>
            </th>
            <td mat-cell *matCellDef="let element" class="text-default">
              <ng-container [ngSwitch]="col">
                <ng-container *ngSwitchCase="'Original Name'">
                  <div *ngIf="isLoading">
                    <app-skeleton-loader
                      [Mode]="mode"
                      [width]="'5rem'"
                      [height]="'1.5rem'"
                      [borderRadius]="'0.159rem'"
                    ></app-skeleton-loader>
                  </div>
                  <div
                    *ngIf="!isLoading"
                    class="d-flex align-items-center table-text-with-icon"
                  >
                    <mat-icon
                      [svgIcon]="chooceIcon(element.extension.split('.')[1])"
                      aria-hidden="false"
                    >
                    </mat-icon>
                    <p
                      class="table-text"
                      matTooltip="{{ element.originalName }}"
                      matTooltipPosition="above"
                      matTooltipPositionAtOrigin="left"
                    >
                      {{ element.originalName }}
                    </p>
                  </div>
                </ng-container>

                <ng-container *ngSwitchCase="'Download'">
                  <div *ngIf="isLoading">
                    <app-skeleton-loader
                      [Mode]="mode"
                      [width]="'5rem'"
                      [height]="'1.5rem'"
                      [borderRadius]="'0.159rem'"
                    ></app-skeleton-loader>
                  </div>
                  <div *ngIf="!isLoading">
                    <button
                      class="btn-edit download"
                      (click)="download(element.URL)"
                      matTooltip="{{ element.URL }}"
                      matTooltipPosition="above"
                      matTooltipPositionAtOrigin="left"
                    >
                      <mat-icon
                        class="download-mat-icon"
                        aria-hidden="false"
                        svgIcon="download"
                      ></mat-icon>
                    </button>
                  </div>
                </ng-container>

                <div *ngIf="loggedUser !== null">
                  <ng-container *ngSwitchCase="'Username'" class="text-center">
                    <div *ngIf="isLoading">
                      <app-skeleton-loader
                        [Mode]="mode"
                        [width]="'5rem'"
                        [height]="'1.5rem'"
                        [borderRadius]="'0.159rem'"
                      ></app-skeleton-loader>
                    </div>
                    <div *ngIf="!isLoading">
                      <p
                        class="m-0 p-0"
                        matTooltip="{{
                          loggedUser.username == element.username
                            ? 'You'
                            : element.username
                        }}"
                        matTooltipPosition="above"
                        matTooltipPositionAtOrigin="left"
                      >
                        {{
                          loggedUser.username == element.username
                            ? "You"
                            : element.username
                        }}
                      </p>
                    </div>
                  </ng-container>
                </div>
                <div *ngIf="loggedUser !== null">
                  <ng-container *ngSwitchCase="'Uploader'" class="text-center">
                    <div *ngIf="isLoading">
                      <app-skeleton-loader
                        [Mode]="mode"
                        [width]="'5rem'"
                        [height]="'1.5rem'"
                        [borderRadius]="'0.159rem'"
                      ></app-skeleton-loader>
                    </div>
                    <div *ngIf="!isLoading">
                      <p
                        class="m-0 p-0"
                        matTooltip="{{
                          loggedUser.username == element.uploader
                            ? 'You'
                            : element.Username
                        }}"
                        matTooltipPosition="above"
                        matTooltipPositionAtOrigin="left"
                      >
                        {{
                          loggedUser.username == element.uploader
                            ? "You"
                            : element.Username
                        }}
                      </p>
                    </div>
                  </ng-container>
                </div>

                <ng-container *ngSwitchDefault>
                  <div *ngIf="isLoading">
                    <app-skeleton-loader
                      [Mode]="mode"
                      [width]="'5rem'"
                      [height]="'1.5rem'"
                      [borderRadius]="'0.159rem'"
                    ></app-skeleton-loader>
                  </div>
                  <div *ngIf="!isLoading">
                    <p
                      class="m-0 p-0"
                      matTooltip="{{ generateColData(col, element) }}"
                      matTooltipPosition="above"
                      matTooltipPositionAtOrigin="left"
                    >
                      {{ generateColData(col, element) }}
                    </p>
                  </div>
                </ng-container>
              </ng-container>
            </td>
          </ng-container>
          <tr
            mat-header-row
            *matHeaderRowDef="displayedColumns"
            class="text-default border-bottom-custom"
          ></tr>
          <tr
            mat-row
            *matRowDef="let row; columns: displayedColumns"
            class="text-default border-bottom-custom"
          ></tr>
        </table>
      </div>
    </div>
  </div>

  <!-- pagination row -->
  <div
    class="row"
    *ngIf="
      loggedUser && user !== null && !isTableEmpty && !isPaginationDisabled
    "
  >
    <div class="col-xl-12">
      <div class="row mt-4">
        <div class="col-xl-12">
          <ul class="pagination justify-content-center d-flex">
            <!-- << Button -->
            <li class="d-flex justify-content-center align-items-center">
              <button
                type="button"
                class="page-item-btn btn-custom w-100 h-75 fw-bold"
                (click)="goTwoPagesBack()"
              >
                <i class="fa fa-angle-double-left"></i>
              </button>
            </li>

            <!-- Page number buttons -->
            <li
              class="d-flex justify-content-center align-items-center"
              *ngFor="
                let i of [].constructor(getActualEnd() - getActualStart() + 1);
                let idx = index
              "
            >
              <button
                type="button"
                class="page-item-btn btn-custom w-100 h-75 fw-bold"
                [ngClass]="
                  currentPage === getActualStart() + idx ? 'active' : 'inactive'
                "
                (click)="setCurrentPage(idx)"
              >
                {{ getActualStart() + idx }}
              </button>
            </li>

            <!-- >> Button -->
            <li class="d-flex justify-content-center align-items-center">
              <button
                type="button"
                class="page-item-btn btn-custom w-100 h-75 fw-bold"
                (click)="goTwoPagesForward()"
              >
                <i class="fa fa-angle-double-right"></i>
              </button>
            </li>
          </ul>
        </div>
      </div>
    </div>
  </div>

  <!-- No table data -->
  <div
    *ngIf="isTableEmpty"
    class="row mt-5 d-flex justify-content-center align-item-center"
  >
    <div class="col-xl-8 d-flex justify-content-center align-item-center">
      <div class="">
        <h5 class="text-center text-uppercase" *ngIf="startDate && endDate">
          File Data Not Found between {{ startDate | date : "MMMM d, y" }} -
          {{ endDate | date : "MMMM d, y" }}
        </h5>
        <h5 class="text-center text-uppercase" *ngIf="!startDate && !endDate">
          File Data Not Found
        </h5>
        <div class="image-container">
          <img
            src="/Images/System-images/noActivities.jpg"
            alt="no activities image"
          />
        </div>
      </div>
    </div>
  </div>
</div>
